<mat-card class="account-card">
  <mat-card-content>
    <form [formGroup]="profileForm" (ngSubmit)="onSave()" class="account-form">

      <!-- Profile Picture -->
      <section class="section profile-section">
        <h2 class="section-title">Account</h2>
        <p class="section-subtitle">Manage your profile details and preferences.</p>
      </section>

      <mat-divider></mat-divider>

      <!-- Full Name -->
      <section class="section">
        <h2 class="section-title">Full Name</h2>
        <div class="form-grid">
          <mat-form-field appearance="outline" class="field">
            <mat-label>First Name</mat-label>
            <input matInput formControlName="firstName" />
            <mat-error>
              <app-form-control-errors [control]="profileForm.get('firstName')"></app-form-control-errors>
            </mat-error>
          </mat-form-field>

          <mat-form-field appearance="outline" class="field">
            <mat-label>Middle Name</mat-label>
            <input matInput formControlName="middleName" />
          </mat-form-field>

          <mat-form-field appearance="outline" class="field">
            <mat-label>Last Name</mat-label>
            <input matInput formControlName="lastName" />
            <mat-error>
              <app-form-control-errors [control]="profileForm.get('lastName')"></app-form-control-errors>
            </mat-error>
          </mat-form-field>
        </div>
      </section>

      <mat-divider></mat-divider>

      <!-- Contact Info -->
      <section class="section">
        <h2 class="section-title">Contact Information</h2>
        <div class="form-grid">
          <mat-form-field appearance="outline" class="field full-width">
            <mat-label>Email Address</mat-label>
            <input matInput type="email" formControlName="emailAddress" />
            <mat-error>
              <app-form-control-errors [control]="profileForm.get('emailAddress')"></app-form-control-errors>
            </mat-error>
          </mat-form-field>

          <mat-form-field appearance="outline" class="field">
            <mat-label>Mobile Number</mat-label>
            <input matInput type="tel" formControlName="mobileNumber" />
            <mat-error>
              <app-form-control-errors [control]="profileForm.get('mobileNumber')"></app-form-control-errors>
            </mat-error>
          </mat-form-field>

          <!-- Address Field -->
          <mat-form-field appearance="outline" class="field full-width">
            <mat-label>Address</mat-label>
            <textarea matInput formControlName="address" rows="2"></textarea>
            <mat-error>
              <app-form-control-errors [control]="profileForm.get('address')"></app-form-control-errors>
            </mat-error>
          </mat-form-field>
        </div>
      </section>

      <!-- Operating Hours -->
      <section class="section" *ngIf="isDentist">
        <div class="header-row">
          <h2 class="section-title">Operating Hours</h2>
          <button mat-flat-button color="accent" type="button" (click)="onAddSchedule()"
            [disabled]="operatingHours.length >= (clinicOperatingHours.value?.length || 0)">
            Add Schedule
          </button>
        </div>

        <div formArrayName="operatingHours" class="schedule">
          <mat-card class="hour-card" *ngFor="let hour of operatingHours.controls; let i = index" [formGroupName]="i">
            <div class="hour-grid">
              <mat-form-field appearance="outline" class="field full-width">
                <mat-label>Day</mat-label>
                <mat-select formControlName="day">
                  <mat-option *ngFor="let day of days" [value]="day.code" [disabled]="getSelectedDays(i).includes(day.code)">
                    {{ day.label }}
                  </mat-option>
                </mat-select>
              </mat-form-field>

              <mat-form-field appearance="outline" class="field half-width">
                <mat-label>From</mat-label>
                <input matInput type="time" formControlName="startTime" />
              </mat-form-field>

              <mat-form-field appearance="outline" class="field half-width">
                <mat-label>To</mat-label>
                <input matInput type="time" formControlName="endTime" />
              </mat-form-field>
            </div>

            <div class="schedule-errors">
              <mat-error *ngIf="hour.errors?.['timeRangeInvalid'] && (hour.touched || hour.dirty)">
                End time must be after start time.
              </mat-error>
              <mat-error *ngIf="hour.errors?.['outsideClinicHours'] && (hour.touched || hour.dirty)">
                Time must be within the clinic's operating hours.
              </mat-error>
            </div>

            <button mat-stroked-button color="warn" type="button" (click)="removeOperatingHour(i)">
              Remove
            </button>
          </mat-card>
        </div>
      </section>

      <!-- Save / Logout Buttons -->
      <div class="button-group">
        <button [disabled]="!profileForm.valid" mat-raised-button color="primary" class="save-btn" type="submit">
          Save Changes
        </button>
        <button mat-stroked-button color="warn" class="logout-btn" type="button" (click)="cancelEdit()">
          Cancel
        </button>
      </div>

    </form>
  </mat-card-content>
</mat-card>
