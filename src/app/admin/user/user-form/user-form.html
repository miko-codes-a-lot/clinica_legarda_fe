<form [formGroup]="rxform" (ngSubmit)="onSubmit()">
  <label for="firstName">First Name </label>
  <input formControlName="firstName" id="firstName">
  <app-form-control-errors [control]="rxform.get('firstName')"></app-form-control-errors>
  <br>
  
  <label for="middleName">Middle Name </label>
  <input formControlName="middleName" id="middleName"> <br>
  
  <label for="lastName">Last Name </label>
  <input formControlName="lastName" id="lastName"> 
  <app-form-control-errors [control]="rxform.get('lastName')"></app-form-control-errors>
  <br>
  
  <label for="emailAddress">Email Address </label>
  <input formControlName="emailAddress" id="emailAddress">
  <app-form-control-errors [control]="rxform.get('emailAddress')"></app-form-control-errors>
  <br>
  
  <label for="mobileNumber">Mobile Number </label>
  <input formControlName="mobileNumber" id="mobileNumber">
  <app-form-control-errors [control]="rxform.get('mobileNumber')" [customMessage]="'Use only digits after +63 (e.g. +639123456789).'"></app-form-control-errors>
  <br>
  
  <label for="address">Address </label>
  <input formControlName="address" id="address"> <br>
  
  @if (!user._id) {
    <label for="password">Password </label>
    <input formControlName="password" id="password" type="password"> <br>
    
    <label for="passwordConfirm">Confirm Password </label>
    <input formControlName="passwordConfirm" id="passwordConfirm" type="password">
    <app-form-control-errors [control]="rxform.get('passwordConfirm')" [customMessage]="'Passwords do not match'"></app-form-control-errors>
    <br>  
  }
  
  <label for="role">Role </label> 
  <select name="role" id="role" formControlName="role">
    <option value="patient">Patient</option>
    <option value="dentist">Dentist</option>
    <option value="admin">Admin</option>
  </select> <br>


  @if (role.value === 'dentist') {
    <label for="clinic">Clinic </label>
    <select name="clinic" id="clinic" formControlName="clinic">
      @for (clinic of clinics; track clinic._id) {
        <option [value]="clinic._id">{{ clinic.name }}</option>
      }
    </select>
    
    @if (!this.clinic.value) {
      <p><i>Please select a clinic</i></p>
    } @else {
      <br> <br>
      <button type="button" (click)="onAddSchedule()">Add Schedule</button> <br> <br>

      <div formArrayName="operatingHours">
        @for (hour of this.operatingHours.controls; track $index) {
          <div [formGroupName]="$index">
            <span>Day </span> 
            <select [id]="'day' + $index" [name]="'day' + $index" formControlName="day">
              @for (day of days; track day.code) {
                <option [value]="day.code">{{ day.label }}</option>
              }
            </select>
            <span> Hours </span>
            <input type="time" formControlName="startTime" [id]="'startTime' + $index">
            <span>-</span>
            <input type="time" formControlName="endTime" [id]="'endTime' + $index">

            @if (hour.errors?.['timeRangeInvalid'] && (hour.touched || hour.dirty)) {
              <div class="error">
                End time must be after start time.
              </div>
            }
          </div> <br>
        }
      </div>

      @if (operatingHours.length === 0) {
        <p><i>Please add a schedule</i></p>
      }
    }
    <br><br>
  }

  <button [disabled]="isLoading || !rxform.valid">Save</button>
</form>