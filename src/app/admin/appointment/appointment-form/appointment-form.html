<form [formGroup]="rxform" (ngSubmit)="onSubmit()">
  @if (clinics.length === 0) {
    <p>Fetching clinics...</p>
  } @else {
    <h2 class="page-title">Appointment</h2>
    <!-- form here -->
    <app-form
      [form]="rxform"
      [fields]="appointmentFields" 
      [isLoading]="isLoading"
      (onSubmitEvent)="onSubmit()"
    >
    </app-form>
  }

  @if (dentists.length === 0) {
    <p>Please select a clinic</p>
  } @else {
    <label for="dentist">Dentist </label>
    <select name="dentist" id="dentist" formControlName="dentist">
      @for(dentist of dentists; track dentist._id) {
        <option [value]="dentist._id">{{ dentist.firstName }} {{ dentist.lastName }}</option>
      }
    </select>
    <app-form-control-errors [control]="dentist"></app-form-control-errors>
    <br>
  }

  @if (patients.length === 0) {
    <p>Fetching patients...</p>
  } @else {
    <label for="patient">Patient </label>
    <select name="patient" id="patient" formControlName="patient">
      @for(patient of patients; track patient._id) {
        <option [value]="patient._id">{{ patient.firstName }} {{ patient.lastName }}</option>
      }
    </select>
    <app-form-control-errors [control]="patient"></app-form-control-errors>
    <br>
  }

  @if (dentalServices.length === 0) {
    <p>Fetching services...</p>
  } @else {
    <label for="services">Services </label> <br>
    <select name="services" id="services" formControlName="services" multiple>
      @for(service of dentalServices; track service._id) {
        <option [value]="service._id">{{ service.name }}</option>
      }
    </select>
    <br>
  }

  <!-- date picker should be here -->
  @if (selectedDentist) {
    <app-date-picker 
      formControlName="date"
      label="Appointment Day"
      placeholder="Choose a date"
      [dentist]="selectedDentist">
    </app-date-picker> <br>

    <app-time-picker
      label="Appointment Time"
      [dentist]="selectedDentist"
      [selectedDate]="date.value"
      [serviceDuration]="60"
      [timeSlotInterval]="30"
      [required]="true"
      formControlName="time"
    >
    </app-time-picker> <br>

    <p><strong>Total Duration:</strong> {{ getFormattedDuration() }}</p>
    <p><strong>Time:</strong> {{ getAppointmentTimeRange() }}</p>
  }

  <button [disabled]="isLoading || !rxform.valid">Save</button>
</form>